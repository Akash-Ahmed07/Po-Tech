{% extends "base.html" %}

{% block title %}Create Blog Post - Po-Tech{% endblock %}

{% block head %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Page Header -->
            <div class="d-flex align-items-center justify-content-between mb-4">
                <div>
                    <h1 class="display-6 fw-bold">Create Blog Post</h1>
                    <p class="text-muted">Share your knowledge with the community</p>
                </div>
                <a href="{{ url_for('blog_list') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Blog
                </a>
            </div>

            <!-- Blog Form -->
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label for="title" class="form-label fw-bold">Title *</label>
                            <input type="text" class="form-control form-control-lg" id="title" name="title" 
                                   placeholder="Enter an engaging title..." required maxlength="200">
                            <small class="text-muted">Make it catchy and descriptive</small>
                        </div>

                        <div class="mb-4">
                            <label for="summary" class="form-label fw-bold">Summary</label>
                            <textarea class="form-control" id="summary" name="summary" rows="3" 
                                      placeholder="Brief description of your post..." maxlength="500"></textarea>
                            <small class="text-muted">Optional: A short summary for previews (max 500 characters)</small>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="category" class="form-label fw-bold">Category *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="general">General</option>
                                    <option value="technology">Technology</option>
                                    <option value="education">Education</option>
                                    <option value="science">Science</option>
                                    <option value="programming">Programming</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="tags" class="form-label fw-bold">Tags</label>
                                <input type="text" class="form-control" id="tags" name="tags" 
                                       placeholder="education, tutorial, tips">
                                <small class="text-muted">Comma-separated tags for better discovery</small>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="featured_image" class="form-label fw-bold">Featured Image</label>
                            <input type="file" class="form-control" id="featured_image" name="featured_image" 
                                   accept="image/*">
                            <small class="text-muted">Optional: Upload a cover image for your post</small>
                        </div>

                        <div class="mb-4">
                            <label for="content" class="form-label fw-bold">Content *</label>
                            <div class="border rounded">
                                <div class="toolbar bg-light p-2 border-bottom">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-outline-secondary" onclick="formatText('bold')">
                                            <i class="fas fa-bold"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="formatText('italic')">
                                            <i class="fas fa-italic"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="formatText('underline')">
                                            <i class="fas fa-underline"></i>
                                        </button>
                                    </div>
                                    <div class="btn-group btn-group-sm ms-2" role="group">
                                        <button type="button" class="btn btn-outline-secondary" onclick="insertList('ul')">
                                            <i class="fas fa-list-ul"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="insertList('ol')">
                                            <i class="fas fa-list-ol"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="insertLink()">
                                            <i class="fas fa-link"></i>
                                        </button>
                                    </div>
                                </div>
                                <textarea class="form-control border-0" id="content" name="content" rows="15" 
                                          placeholder="Write your blog content here..." required 
                                          style="resize: vertical;"></textarea>
                            </div>
                            <small class="text-muted">Use basic HTML tags for formatting if needed</small>
                        </div>

                        <div class="d-flex gap-3">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Publish Post
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-save me-2"></i>Save Draft
                            </button>
                            <button type="button" class="btn btn-outline-info btn-lg" onclick="previewPost()">
                                <i class="fas fa-eye me-2"></i>Preview
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Blog Post Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="previewContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
function formatText(command) {
    const textarea = document.getElementById('content');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    
    let formattedText = '';
    switch(command) {
        case 'bold':
            formattedText = `<strong>${selectedText}</strong>`;
            break;
        case 'italic':
            formattedText = `<em>${selectedText}</em>`;
            break;
        case 'underline':
            formattedText = `<u>${selectedText}</u>`;
            break;
    }
    
    textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
    textarea.focus();
}

function insertList(type) {
    const textarea = document.getElementById('content');
    const start = textarea.selectionStart;
    const tag = type === 'ul' ? '<ul>\n<li></li>\n</ul>' : '<ol>\n<li></li>\n</ol>';
    
    textarea.value = textarea.value.substring(0, start) + tag + textarea.value.substring(start);
    textarea.focus();
}

function insertLink() {
    const textarea = document.getElementById('content');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    
    const url = prompt('Enter URL:');
    if (url) {
        const linkText = selectedText || 'Link Text';
        const link = `<a href="${url}">${linkText}</a>`;
        textarea.value = textarea.value.substring(0, start) + link + textarea.value.substring(end);
    }
    textarea.focus();
}

function previewPost() {
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const category = document.getElementById('category').value;
    
    const previewHTML = `
        <div class="mb-3">
            <span class="badge bg-primary">${category}</span>
        </div>
        <h2>${title}</h2>
        <div class="mt-3">${content}</div>
    `;
    
    document.getElementById('previewContent').innerHTML = previewHTML;
    new bootstrap.Modal(document.getElementById('previewModal')).show();
}

// Character counter for title
document.getElementById('title').addEventListener('input', function() {
    const maxLength = 200;
    const currentLength = this.value.length;
    const remaining = maxLength - currentLength;
    
    // Add or update character counter
    let counter = this.parentNode.querySelector('.char-counter');
    if (!counter) {
        counter = document.createElement('small');
        counter.className = 'char-counter text-muted';
        this.parentNode.appendChild(counter);
    }
    
    counter.textContent = `${remaining} characters remaining`;
    counter.className = `char-counter ${remaining < 20 ? 'text-warning' : 'text-muted'}`;
});
</script>
{% endblock %}
